<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>AEM React</title>

    <!-- Bootstrap -->
    <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="highlight.js/styles/github.css">
    <link rel="stylesheet" href="main.css"/>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body>
    <div class="container"/>
    <div class="row">
        <div class="col-md-9" style="position:relative">
            <h1>AEM React</h1>
                <h2 id="nav_0">1 Introduction</h2>
                
                    <p>The goal of the AEM (<a href="http://www.adobe.com/de/marketing-cloud/enterprise-content-management.html">Adobe Experience Manager</a>) React library is to use <a href="https://facebook.github.io/react/">React</a> as a templating engine
for AEM components. React is a popular javascript ui library by facebook.</p>
<h4>Why React and AEM?</h4><p>React components are ideal to create web applications with complex client-side interactivity. AEM provides a perfect authoring interface for web content.
This project brings these technologies together, so that you can build highly interactive web pages with a professional authoring tool.</p>
<h4>Features</h4><ul>
<li><a href="http://www.2ality.com/2015/08/isomorphic-javascript.html">Universal</a> React rendering</li>
<li>High performance javascript execution with a pool of Java 8 <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/">nashorn</a> engines.</li>
<li>Nesting React components in other AEM components and vice versa is supported.</li>
<li>Converting vanilla (plain) react components into AEM components is supported.</li>
<li>SPA based on react router is supported.</li>
</ul>
<h4>Projects</h4><h5>AEM project</h5><p>The <a href="https://github.com/sinnerschrader/aem-react">aem-react project</a> consists of the following parts:</p>
<ul>
<li>osgi bundle contains the Sling Script Engine to render AEM components written in react.</li>
<li>maven archetype is a fork of the AEM archetype and adds react support and examples.</li>
<li>demo content package provides examples for components and SPA.</li>
</ul>
<p>Maven artifact is available via <a href="http://search.maven.org/#search%7Cga%7C1%7Caem-react">maven central</a></p>
<h5>Javascript project</h5><p>The aem-react projects relies on the <a href="https://github.com/sinnerschrader/aem-react-js">aem-react-js subproject</a>, which provides
the basic javascript funtionality. It is
available as <a href="https://www.npmjs.com/package/aem-react-js">npm
 module</a>.</p>
<h5>Maven archetype project</h5><p>Lastly a <a href="https://github.com/sinnerschrader/aem-project-archetype">maven-archetype</a> is avilable to quickly create an AEM maven project including react components.
It is a fork of the existing offical <a href="https://github.com/Adobe-Marketing-Cloud/aem-project-archetype">AEM maven archetype</a>.</p>
<p>Maven artifact is available via <a href="http://search.maven.org/#search%7Cga%7C1%7Csinnerschrader">maven central</a></p>
<div class="bs-callout bs-callout-info"><h4>Version </h4><p>This documentation always describes the latest version (not release) of these projects.</p>
</div><h4>Prerequisites</h4><ul>
<li><code>&gt;=</code> Java 8 (Oracle JDK with nashorn engine)</li>
<li><code>&gt;=</code> AEM 6.0</li>
</ul>

                <h2 id="nav_1">2 Getting Started</h2>
                
                    <p>In this guide we will use the maven archetype to generate a project structure.
It already includes some demo content and react components.</p>
<p><em>Requirements</em></p>
<ul>
<li>Adobe Experience Manager 6 or higher</li>
<li>Apache Maven (3.x should do)</li>
</ul>
<p>The example react components are written in Typescript. The node build tools
are also assuming that you are developing in Typescript. If you want to use another dialect you need to
tewak the build scripts.</p>

                    <h3 id="subnav_1_0">2.1 First project</h3>
                    <p>To quickly get started we will use the maven archetype.</p>
<h4>1. create maven project</h4><pre><code class="lang-bash"> mvn archetype:generate \
  -<span class="ruby"><span class="hljs-constant">DarchetypeGroupId</span>=com.sinnerschrader.aem.react \
</span>  -<span class="ruby"><span class="hljs-constant">DarchetypeArtifactId</span>=aem-project-archetype \
</span>  -<span class="ruby"><span class="hljs-constant">DarchetypeVersion</span>=<span class="hljs-number">10.2</span> \</span>
</code></pre>
<p> You will then be asked a couple of questions about project name and folder names and so on.
 These are the same as in the original archetype. Please find detailed
 explanations <a href="https://docs.adobe.com/docs/en/aem/6-0/develop/dev-tools/ht-projects-maven.html">here</a> in the section &quot;Getting started in
 5 minutes&quot;.</p>
<p><strong>Available properties</strong></p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>groupId</th>
<th>Maven GroupId</th>
</tr>
</thead>
<tbody>
<tr>
<td> groupId</td>
<td>Base Maven groupId</td>
</tr>
<tr>
<td> artifactId</td>
<td>Base Maven ArtifactId</td>
</tr>
<tr>
<td> version</td>
<td>Version</td>
</tr>
<tr>
<td> package</td>
<td>Java Source Package</td>
</tr>
<tr>
<td> appsFolderName</td>
<td>/apps folder name</td>
</tr>
<tr>
<td> artifactName</td>
<td>Maven Project Name</td>
</tr>
<tr>
<td> componentGroupName</td>
<td>AEM component group name</td>
</tr>
<tr>
<td> contentFolderName</td>
<td>/content folder name</td>
</tr>
<tr>
<td> cssId</td>
<td>prefix used in generated css</td>
</tr>
<tr>
<td> packageGroup</td>
<td>Content Package Group name</td>
</tr>
<tr>
<td> siteName</td>
<td>AEM site name</td>
</tr>
</tbody>
</table>
<h4>2. start AEM</h4><p> AEM should now be running.</p>
<h4>3. install demo</h4><pre><code class="lang-bash"> <span class="hljs-keyword">mvn </span>install -PautoInstallPackage
</code></pre>
<p>If your AEM instance is not running on localhost:4503 then you need to add additonal parameter</p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>parameter</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr>
<td>-Daem.port</td>
<td>4502</td>
</tr>
<tr>
<td>-Daem.host</td>
<td>localhost</td>
</tr>
</tbody>
</table>
<h4>4. Open browser</h4><p>To check what was deployed we will use the Classic UI.</p>
<ul>
<li>go to the page /content/${siteName}/en.html</li>
<li>find react components in sidekick: <em>React Panel</em>, <em>React Text</em> and <em>ReactParsys</em></li>
<li>find components already on the page</li>
</ul>
<p><div class="center-block caption-fix">
    <img src="page_sidekick.png" class="center-block img-responsive" alt="title" />
    <div class="caption">
        <p >The page en.html with sidekick</p>
    </div>
</div></p>
<h4>5. disable author mode</h4><p>To check that we have actual react components in the page we will use the Classic UI.</p>
<ul>
<li>Disabled the author mode by appending <code>?wcmmode=disabled</code> to the url.</li>
<li>Install your <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">react dev tool</a> in
chrome browser.</li>
<li>Have a look at react component tree.</li>
</ul>
<p><div class="center-block caption-fix">
    <img src="page_dev_tool.png" class="center-block img-responsive" alt="title" />
    <div class="caption">
        <p >The page en.html with react dev tools</p>
    </div>
</div></p>
<p>There are two <em>RootComponents</em> which means two independent react component trees.
The first contains the <em>Text</em> component.
The second contains the <em>Panel</em> which is a vanilla react component and therefore wrapped by a <em>TheWrapper</em> component.
The Panel&#39;s child is a <em>ReactParsys</em> which contains another <em>Text</em> component and a non-react component which inserted by the
<em>ResourceInclude</em> component.</p>

                    <h3 id="subnav_1_1">2.2 First component</h3>
                    <p>This part assumes that the project was created according to the previous chapter.</p>
<h4>1. Start watch task</h4><p>Start the watch task which transpiles, bundles and uploads the javascript files to AEM.</p>
<p>Open console to folder /src/main/ts and run the watch task  <code>npm run watch</code>.</p>
<p>If your AEM instance is not running on localhost:4502 then you need to make these configurations:</p>
<pre><code class="lang-bash">npm config <span class="hljs-operator"><span class="hljs-keyword">set</span> demo:crx <span class="hljs-keyword">http</span>://<span class="hljs-keyword">admin</span>:<span class="hljs-keyword">admin</span>@localhost:<span class="hljs-number">4502</span>/crx/repository/crx.<span class="hljs-keyword">default</span></span>
</code></pre>
<p>Alternatively the config in the package.json can be modified.</p>
<h4>2. create file</h4><p>Create a file MyComponent.tsx under /ui.apps/src/main/ts/.</p>
<pre><code class="lang-typescript">

<span class="scala"><span class="hljs-keyword">import</span> {<span class="hljs-type">ResourceComponent</span>} from <span class="hljs-string">"aem-react-js/component/ResourceComponent"</span>;
<span class="hljs-keyword">import</span> * as <span class="hljs-type">React</span> from <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-type">Text</span> from <span class="hljs-string">"../text/text"</span>;

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">ResourceComponent&lt;any</span>, <span class="hljs-title">any</span>, <span class="hljs-title">any&gt;</span> {</span>
    public renderBody(): <span class="hljs-type">React</span>.<span class="hljs-type">ReactElement</span>&lt;any&gt; {

        let label: string = <span class="hljs-keyword">this</span>.getResource().label;
        <span class="hljs-keyword">return</span> (
            &lt;div&gt;
                &lt;span&gt;<span class="hljs-type">Hello</span> {label}&lt;/span&gt;
                &lt;<span class="hljs-type">Text</span> path=<span class="hljs-string">"text"</span>/&gt;
            &lt;/div&gt;
        );
    }
}</span>
</code></pre>
<h4>3. Register component</h4><p>The component needs to be associated with a resourceType <code>${appsFolderName}</code>/components/my-component.
Open /ui.apps/src/main/ts/componentRegistry.tsx and add two lines</p>
<pre><code class="lang-typescript"> <span class="hljs-comment">// add this line at the top</span>
 <span class="hljs-keyword">import</span> MyComponent <span class="hljs-keyword">from</span> <span class="hljs-string">"./MyComponent"</span>;
 ...
 <span class="hljs-comment">// add this line after componentRegistry is instantiated</span>
 componentRegistry.register(MyComponent);
</code></pre>
<h4>4. Create component configuration</h4><p>Create the component configuration in the appropriate folder <code>/apps/${appsFolderName}/components/my-component</code>.
The template is an empty file called <code>my-component.jsx</code>. The edit dialog should
provide a textfield for the property <code>./label</code>.</p>
<ul>
<li>/apps/${appsFolderName}/components/my-component<ul>
<li>.content.xml</li>
<li>my-component.jsx</li>
<li>dialog.xml</li>
</ul>
</li>
</ul>
<h4>5. Synchronize source code to crx</h4><p>The component configuration must be uploaded to crx. This can be done
via maven install -PautoInstallPackage. The watch task has already uploaded the javascript file.</p>
<h4>6. Open browser</h4><p> find the new react component in the sidekick.</p>
<h4>7. Continuely improve component</h4>
                <h2 id="nav_2">3 Development Guide</h2>
                
                    <h3 id="subnav_2_0">3.1 ResourceComponent</h3>
                    <p>ResourceComponent is the base class for AEM components. It provides access to the
resource (content). It also adds the necessary wrapper element, so that the component
can be edited in the author mode.</p>
<p>The main method to implement in a ResourceComponent is <code>renderBody()</code>. It is called
by the <code>render</code> method once the resource is successfully fetched. The resource is available via <code>this.getResource()</code>.</p>
<pre><code class="lang-typescript">
<span class="hljs-keyword">import</span> {ResourceComponent} <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/component/ResourceComponent"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> Text <span class="hljs-keyword">from</span> <span class="hljs-string">"../text/text"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResourceComponent</span>&lt;<span class="hljs-title">any</span>, <span class="hljs-title">any</span>, <span class="hljs-title">any</span>&gt; </span>{
    public renderBody(): React.ReactElement&lt;any&gt; {

        <span class="hljs-keyword">let</span> label: string = <span class="hljs-keyword">this</span>.getResource().label;
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">span</span>&gt;</span>Hello {label}<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        )</span>;
    }
}
</code></pre>

                    <h3 id="subnav_2_1">3.2 Registering react component</h3>
                    <p>There must be one instance of <code>RootComponentRegistry</code>. It is responsible for mapping each React component to a resourceType.
A component is a registered with one of the <code>ComponentRegistry</code>s which are maped to a resource path.</p>
<pre><code class="lang-typescript"><span class="hljs-keyword">import</span> ComponentRegistry <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/ComponentRegistry"</span>;
<span class="hljs-keyword">import</span> RootComponentRegistry <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/RootComponentRegistry"</span>;
<span class="hljs-keyword">import</span> MyComponent <span class="hljs-keyword">from</span> <span class="hljs-string">"./MyComponent"</span>;

<span class="hljs-keyword">let</span> registry: ComponentRegistry = <span class="hljs-keyword">new</span> ComponentRegistry(<span class="hljs-string">"yourproject/components"</span>);
registry.register(MyComponent); <span class="hljs-comment">// resource type of MyComponent is 'yourproject/components/my-component'</span>

<span class="hljs-keyword">let</span> rootComponentRegistry: RootComponentRegistry = <span class="hljs-keyword">new</span> RootComponentRegistry();
rootComponentRegistry.add(componentRegistry);
rootComponentRegistry.init();
AemGlobal.registry = rootComponentRegistry; <span class="hljs-comment">// expose registry to Nashorn</span>
</code></pre>
<p>If your project was created by the maven archetpye then the RootComponentRegistry is already instantiated and you just need to add your <code>ComponentRegistry</code>.`</p>

                    <h3 id="subnav_2_2">3.3 Loading Resource</h3>
                    <p>The resource will be loaded as json by calling <code>getResource()</code> and therefore the number of levels of the resource tree need to be defined
 in
advance by
overriding the method <code>getDepth()</code>. In accordance with the sling conventions 0 means a single level.</p>
<pre><code class="lang-typescript">     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">getDepth</span>(<span class="hljs-params"></span>): number </span>{
         <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
     }
</code></pre>
<h4>Lazy Loading</h4><p>If the resource is not fetched synchronuously then the <code>render</code> method will call <code>renderLoading</code> instead to display a loading spinner or
similar ui.
Asynchronuous loading happens when a ResourceComponent&#39;s path prop is changed or a new ResourceComponent
is added to the resource tree in the client. This is often the case when the react router library is used.</p>
<pre><code class="lang-typescript">    <span class="hljs-keyword">public</span> renderLoading(): React.ReactElement&lt;<span class="hljs-built_in">any</span>&gt; {

        <span class="hljs-keyword">return</span> (
            &lt;span&gt;Loading <span class="hljs-type">data</span> ...&lt;/spany&gt;
        );
    }
</code></pre>

                    <h3 id="subnav_2_3">3.4 Author mode</h3>
                    <p>React components are not instantiated in the author mode to prevent anyy interference between AEM javascript
and react. For a lot of components this means that they need to be displayed differently. For example
an Accordion must display all panels and its corresponding parsys. Use <code>isWcmEnabled()</code> on the server
to detect the author mode.</p>

                    <h3 id="subnav_2_4">3.5 Java Api</h3>
                    <p>Presentation logic is often implemented in sling models. To access a sling model or an osgi service
the fully qualified java class name needs to be passed to appropriate method. The object returned is
a <code>aem-react-js/ServiceProxy</code>, which has a single method <code>invoke</code>. That method&#39;s first parameter is the
actual java method to invoke and the remaining parameters are passed to that method.</p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>getResourceModel(className)</td>
<td>adapt the current resource to the given class name.</td>
</tr>
<tr>
<td>getRequestModel(className)</td>
<td>adapt the current request to the given class name.</td>
</tr>
<tr>
<td>getOsgiService(className)</td>
<td>get the osgi service by its service class name</td>
</tr>
</tbody>
</table>
<pre><code class="lang-typescript">    import ServiceProxy <span class="hljs-keyword">from</span> <span class="hljs-string">"aem-react-js/ServiceProxy"</span>;
    ...
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">renderBody</span>(<span class="hljs-params"></span>): React.ReactElement&lt;any&gt; </span>{
        <span class="hljs-keyword">let</span> model: ServiceProxy = <span class="hljs-keyword">this</span>.getRequestModel(`com.example.LabelModel`);
        <span class="hljs-keyword">let</span> label: <span class="hljs-keyword">string</span> = model.invoke(<span class="hljs-string">'getLabel'</span>)
        <span class="hljs-keyword">return</span> (
            &lt;div&gt;
                &lt;span&gt;Hello {label}&lt;/span&gt;
            &lt;/div&gt;
        );
    }
</code></pre>
<p>The Java API methods will be invoked only if the component&#39;s is rendered on the server.
Otherwise the return value is served from the cache which was created during server rendering.
It is safe to invoke a java method in the <code>renderBody</code> method. But it must be invoked
unconditionally and always with the same parameters. Initially <code>renderBody</code> will always be invoked on the server but
it can be invoked on the client many times after that.</p>
<p> If a service is needed to load data based on user input then you should not
 use the Java api but use a custom http service via plain ajax.</p>

                    <h3 id="subnav_2_5">3.6 Vanilla component</h3>
                    <p>A vanilla react component can be registered
as a AEM component as well.</p>
<pre><code class="lang-typescript"><span class="hljs-tag">registry</span><span class="hljs-class">.registerVanilla</span>(<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">component</span>:<span class="hljs-value"> TextField</span></span></span>});
<span class="hljs-tag">registry</span><span class="hljs-class">.registerVanilla</span>(<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">component</span>:<span class="hljs-value"> Panel, parsysPath: <span class="hljs-string">"content"</span>, depth: <span class="hljs-number">2</span></span></span></span>});
</code></pre>
<p>All resource properties are passed as props to the component.</p>
<p>For a simple component that only needs a single level of the resource tree
 and doesn&#39;t display children it is sufficient to define the React component class
 that should be registered. The following additional parameters are available</p>
<table class="table table-bordered table-striped">
<thead>
<tr>
<th>parameter</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td> depth</td>
<td>number</td>
<td>the number of levels of the resource available</td>
</tr>
<tr>
<td> parsysPath</td>
<td>string</td>
<td>define this property to add a parsys as only child under the given path.</td>
</tr>
</tbody>
</table>

                <h2 id="nav_3">4 Tools</h2>
                
                    <p>This section describes the development tools for react components that are
installed in rojects created with the maven archetype.
The tools are installed in the directory <code>ui.apps/src/main/ts</code>.</p>

        </div>
        <div class="col-md-3">
            <nav id="navigation" class="bs-docs-sidebar affix">
                <ul class="nav bs-docs-sidenav">
                        <li>
                            <a href="#nav_0">1 Introduction</a>
                        </li>
                        <li>
                            <a href="#nav_1">2 Getting Started</a>
                            <ul class="nav">
                                    <li>
                                        <a href="#subnav_1_0">2.1 First project</a>
                                    </li>
                                    <li>
                                        <a href="#subnav_1_1">2.2 First component</a>
                                    </li>
                            </ul>
                        </li>
                        <li>
                            <a href="#nav_2">3 Development Guide</a>
                            <ul class="nav">
                                    <li>
                                        <a href="#subnav_2_0">3.1 ResourceComponent</a>
                                    </li>
                                    <li>
                                        <a href="#subnav_2_1">3.2 Registering react component</a>
                                    </li>
                                    <li>
                                        <a href="#subnav_2_2">3.3 Loading Resource</a>
                                    </li>
                                    <li>
                                        <a href="#subnav_2_3">3.4 Author mode</a>
                                    </li>
                                    <li>
                                        <a href="#subnav_2_4">3.5 Java Api</a>
                                    </li>
                                    <li>
                                        <a href="#subnav_2_5">3.6 Vanilla component</a>
                                    </li>
                            </ul>
                        </li>
                        <li>
                            <a href="#nav_3">4 Tools</a>
                        </li>
                </ul>
            </nav>
        </div>
    </div>
    <footer class="footer">
        <p>generated on Sun Oct 16 2016 15:21:55 GMT+0000 (UTC)</p>
    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery/dist/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/dist/js/bootstrap.js"></script>
    <script>$('body').scrollspy({target: '#navigation'})</script>
</body>
</html>
